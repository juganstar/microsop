{% extends "frontend/base.html" %}
{% load static i18n %}

{% block content %}

<!-- Hero Section -->
<section class="min-h-screen flex flex-col justify-center items-center text-center px-6 py-20 bg-gradient-to-br from-gray-900 to-black">
  <h1 class="text-5xl font-extrabold mb-6 tracking-tight animate-fade-in-up">
    {% trans "Generate Professional SOPs with AI" %}
  </h1>
  <p class="text-xl text-gray-300 max-w-2xl mb-10 animate-fade-in-up delay-100">
    {% trans "Create and send operational procedures in one click. For freelancers and small teams." %}
  </p>

  <div class="flex gap-4">
    {% if user.is_authenticated %}
      <!-- Logout (POST, redirects to home) -->
      <form method="post" action="{% url 'logout-submit' %}">
        {% csrf_token %}
        <button type="submit" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded-xl text-lg">
          {% trans "Logout" %}
        </button>
      </form>
    {% else %}
      <!-- Open Login (loads body into global #modal from base.html) -->
      <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-xl text-lg"
              hx-get="{% url 'login-modal' %}"
              hx-target="#modal-content"
              hx-swap="innerHTML">
        {% trans "Login" %}
      </button>
    
      <!-- Open Register (loads body into global #modal) -->
      <button class="bg-gray-800 hover:bg-gray-700 px-6 py-3 rounded-xl text-lg border border-gray-600"
              hx-get="{% url 'register-modal' %}"
              hx-target="#modal-content"
              hx-swap="innerHTML">
        {% trans "Create Account" %}
      </button>
    {% endif %}
  </div>

  <!-- Open Trial Config (loads body into global #modal) -->
  <button
    class="mt-6 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl shadow-lg transition duration-200"
    hx-get="{% url 'trial-config' %}"
    hx-target="#modal-content"
    hx-swap="innerHTML">
    {% trans "Activate Free Trial" %}
  </button>

  <!-- Generate SOP button directly under the trial button -->
  <button
    class="mt-3 bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-xl shadow-lg transition duration-200"
    hx-get="{% url 'api-generate-form' %}"
    hx-target="#modal-content"
    hx-swap="innerHTML">
    {% trans "Generate SOP" %}
  </button>
</section>

<!-- Features Section -->
<section class="bg-gray-950 text-white py-20 px-6 animate-fade-in">
  <div class="max-w-5xl mx-auto grid md:grid-cols-3 gap-8 text-left">
    <div>
      <h2 class="text-xl font-semibold mb-2">1. {% trans "Describe" %}</h2>
      <p class="text-gray-400">{% trans "Fill a short form with the type of SOP you need." %}</p>
    </div>
    <div>
      <h2 class="text-xl font-semibold mb-2">2. {% trans "Generate" %}</h2>
      <p class="text-gray-400">{% trans "Our AI engine automatically creates the content for you." %}</p>
    </div>
    <div>
      <h2 class="text-xl font-semibold mb-2">3. {% trans "Use" %}</h2>
      <p class="text-gray-400">{% trans "Copy, edit, or send directly to your clients." %}</p>
    </div>
  </div>
</section>

<!-- Pricing & Plans -->
<section class="bg-black text-white py-20 px-6 animate-fade-in">
  <div class="max-w-4xl mx-auto text-center">
    <h2 class="text-3xl font-bold mb-6">{% trans "Transparent Pricing" %}</h2>
    <p class="text-gray-400 mb-10">{% trans "Choose the plan that fits your workflow." %}</p>

    <div class="grid md:grid-cols-3 gap-8 text-left">

      <!-- Trial -->
      <div class="border border-gray-700 p-6 rounded-xl">
        <h3 class="text-xl font-semibold mb-2">{% trans "Trial" %}</h3>
        <p class="text-2xl font-bold">€0 / {% trans "month" %}</p>
        <ul class="mt-4 text-gray-400 space-y-2 text-sm">
          <li>{% trans "5 generations (one-time)" %}</li>
          <li>{% trans "No credit card required" %}</li>
          <li>{% trans "Upgrade anytime" %}</li>
        </ul>

        <div class="mt-6">
          {% if user.is_authenticated %}
            <button
              class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl"
              hx-get="{% url 'trial-config' %}"
              hx-target="#modal-content"
              hx-swap="innerHTML">
              {% trans "Activate Free Trial" %}
            </button>
          {% else %}
            <button
              class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-xl"
              hx-get="{% url 'login-modal' %}"
              hx-target="#modal-content"
              hx-swap="innerHTML">
              {% trans "Login to start" %}
            </button>
          {% endif %}
        </div>
      </div>

      <!-- Basic -->
      <div class="border border-gray-700 p-6 rounded-xl">
        <h3 class="text-xl font-semibold mb-2">Basic</h3>
        <p class="text-2xl font-bold">€10 / {% trans "month" %}</p>
        <ul class="mt-4 text-gray-400 space-y-2 text-sm">
          <li>{% trans "100 generations / month" %}</li>
          <li>{% trans "Commercial use" %}</li>
          <li>{% trans "Email & checklist formats" %}</li>
        </ul>

        <div class="mt-6">
          {% if user.is_authenticated %}
            <button
              class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-xl"
              onclick="stripeSubscribe('{% url 'billing:subscribe_basic' %}')">
              {% trans "Subscribe Basic" %} (€10)
            </button>
          {% else %}
            <button
              class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-xl"
              hx-get="{% url 'login-modal' %}"
              hx-target="#modal-content"
              hx-swap="innerHTML">
              {% trans "Login to subscribe" %}
            </button>
          {% endif %}
        </div>
      </div>

      <!-- Premium -->
      <div class="border border-purple-600 p-6 rounded-xl bg-purple-900/10">
        <h3 class="text-xl font-semibold mb-2">Premium</h3>
        <p class="text-2xl font-bold">€15 / {% trans "month" %}</p>
        <ul class="mt-4 text-gray-300 space-y-2 text-sm">
          <li>{% trans "200 generations / month" %}</li>
          <li>{% trans "Priority support" %}</li>
          <li>{% trans "SMS sending (via Twilio)" %}</li>
        </ul>

        <div class="mt-6">
          {% if user.is_authenticated %}
            <button
              class="w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-xl"
              onclick="stripeSubscribe('{% url 'billing:subscribe_premium' %}')">
              {% trans "Subscribe Premium" %} (€15)
            </button>
          {% else %}
            <button
              class="w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-xl"
              hx-get="{% url 'login-modal' %}"
              hx-target="#modal-content"
              hx-swap="innerHTML">
              {% trans "Login to subscribe" %}
            </button>
          {% endif %}
        </div>
      </div>
    </div>

    {% if user.is_authenticated %}
      <div class="mt-10">
        <button
          class="bg-gray-800 hover:bg-gray-700 text-white px-6 py-2 rounded-xl"
          onclick="stripePortal('{% url 'billing:customer_portal' %}')">
          {% trans "Manage billing" %}
        </button>
        <p class="text-xs text-gray-500 mt-2">{% trans "Cancel anytime via Stripe." %}</p>
      </div>
    {% endif %}
  </div>

  <!-- Minimal JS helpers for Stripe POST + redirect -->
  <script>
    (function(){
      function getCookie(name){
        const m = document.cookie.match(new RegExp('(?:^| )' + name + '=([^;]+)'));
        return m ? decodeURIComponent(m[1]) : null;
      }
      window.stripeSubscribe = function(url){
        const token = getCookie('csrftoken');
        fetch(url, { method:'POST', headers:{ 'X-CSRFToken': token || '' } })
          .then(r => r.json())
          .then(d => { if (d.url) window.location = d.url; })
          .catch(()=>{ /* optionally show a toast */ });
      };
      window.stripePortal = function(url){
        const token = getCookie('csrftoken');
        fetch(url, { method:'POST', headers:{ 'X-CSRFToken': token || '' } })
          .then(r => r.json())
          .then(d => { if (d.url) window.location = d.url; })
          .catch(()=>{ /* optionally show a toast */ });
      };
    })();
  </script>
</section>

<!-- Testimonials -->
<section class="bg-gray-950 text-white py-20 px-6 animate-fade-in">
  <div class="max-w-3xl mx-auto text-center">
    <h2 class="text-3xl font-bold mb-10">{% trans "What users say" %}</h2>
    <div class="space-y-10">
      <blockquote class="border-l-4 border-purple-600 pl-4 text-left">
        <p class="italic">{% trans "I can finally send professional emails in seconds. Saves me 2 hours a week." %}</p>
        <footer class="text-sm text-gray-400 mt-2">— João, Designer Freelancer</footer>
      </blockquote>
      <blockquote class="border-l-4 border-purple-600 pl-4 text-left">
        <p class="italic">{% trans "I use this for every new client. It feels like I have a personal assistant." %}</p>
        <footer class="text-sm text-gray-400 mt-2">— Ana, Consultant</footer>
      </blockquote>
    </div>
  </div>
</section>

<!-- Final CTA -->
<section class="bg-black text-white text-center py-20 animate-fade-in">
  <h2 class="text-3xl font-bold mb-6">{% trans "Ready to automate your work?" %}</h2>
  {% if user.is_authenticated %}
    <button class="bg-emerald-600 hover:bg-emerald-700 px-8 py-4 rounded-xl text-lg"
            hx-get="{% url 'api-generate-form' %}"
            hx-target="#modal-content"
            hx-swap="innerHTML">
      {% trans "Generate SOP" %}
    </button>
  {% else %}
    <button class="bg-purple-600 hover:bg-purple-700 px-8 py-4 rounded-xl text-lg"
            hx-get="{% url 'register-modal' %}"
            hx-target="#modal-content"
            hx-swap="innerHTML">
      {% trans "Get started" %}
    </button>
  {% endif %}
</section>

{# ===== Trial Modal (auto-open via global modal) ===== #}

{% if show_trial_modal %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // If an old inline trial-modal exists, nuke it (defensive).
    const legacy = document.getElementById('trial-modal');
    if (legacy) legacy.remove();

    // Load the trial-config partial into the global modal body.
    if (window.htmx) {
      htmx.ajax('GET', "{% url 'trial-config' %}", '#modal-content');
    } else {
      // Fallback if HTMX isn’t loaded for some reason.
      window.location.href = "{% url 'trial-config' %}";
    }
  });
</script>
{% endif %}

{% endblock %}
